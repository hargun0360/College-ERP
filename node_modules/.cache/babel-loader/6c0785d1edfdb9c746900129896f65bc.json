{"ast":null,"code":"import axios from'axios';import url from'./BackendUrl';var instance=axios.create({baseURL:url});instance.interceptors.response.use(function(response){return response;},function(error){var originalRequest=error.config;console.log(originalRequest);if(error){if(error.response.status===401&&originalRequest.url===url+\"auth/renewtoken\"){localStorage.clear();window.location.href='/Login';return Promise.reject(error);}if(error.response.status===401&&!originalRequest._retry){originalRequest._retry=true;var refreshToken=localStorage.getItem('ref_token');if(refreshToken){console.log(\"calling request\");return axios.post(url+'auth/renewtoken',{refresh_token:refreshToken},{headers:{Authorization:'Bearer '+refreshToken}}).then(function(res){if(res.status===201||res.status===200){console.log(\"sucess\");localStorage.setItem(\"ref_token\",res.data.refresh_token);localStorage.setItem(\"user\",res.data.access_token);originalRequest.headers[\"Authorization\"]='Bearer '+localStorage.getItem('user');return axios(originalRequest);}}).catch(function(err){console.log(err.response);localStorage.clear();window.location.href='/Login';});}else{console.log(\"No ref token was found\");localStorage.clear();return window.location.href='/Login';}}}return Promise.reject(error);});export default instance;","map":{"version":3,"sources":["E:/project1/project/src/src/ApiServices/Interceptor.js"],"names":["axios","url","instance","create","baseURL","interceptors","response","use","error","originalRequest","config","console","log","status","localStorage","clear","window","location","href","Promise","reject","_retry","refreshToken","getItem","post","refresh_token","headers","Authorization","then","res","setItem","data","access_token","catch","err"],"mappings":"AAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,GAAP,KAAgB,cAAhB,CAEA,GAAMC,CAAAA,QAAQ,CAAGF,KAAK,CAACG,MAAN,CACb,CACIC,OAAO,CAAEH,GADb,CADa,CAAjB,CAOAC,QAAQ,CAACG,YAAT,CAAsBC,QAAtB,CAA+BC,GAA/B,CAAmC,SAACD,QAAD,CAAc,CAC7C,MAAOA,CAAAA,QAAP,CACF,CAFF,CAEI,SAAUE,KAAV,CAAiB,CAEjB,GAAMC,CAAAA,eAAe,CAAGD,KAAK,CAACE,MAA9B,CACAC,OAAO,CAACC,GAAR,CAAYH,eAAZ,EAEA,GAAGD,KAAH,CAAS,CACL,GAAIA,KAAK,CAACF,QAAN,CAAeO,MAAf,GAA0B,GAA1B,EAAiCJ,eAAe,CAACR,GAAhB,GAAwBA,GAAG,CAAG,iBAAnE,CAAsF,CAClFa,YAAY,CAACC,KAAb,GACAC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuB,QAAvB,CACA,MAAOC,CAAAA,OAAO,CAACC,MAAR,CAAeZ,KAAf,CAAP,CACH,CAED,GAAIA,KAAK,CAACF,QAAN,CAAeO,MAAf,GAA0B,GAA1B,EAAiC,CAACJ,eAAe,CAACY,MAAtD,CAA8D,CAE1DZ,eAAe,CAACY,MAAhB,CAAyB,IAAzB,CACA,GAAMC,CAAAA,YAAY,CAAGR,YAAY,CAACS,OAAb,CAAqB,WAArB,CAArB,CACA,GAAGD,YAAH,CAAgB,CACZX,OAAO,CAACC,GAAR,CAAY,iBAAZ,EACA,MAAOZ,CAAAA,KAAK,CAACwB,IAAN,CAAWvB,GAAG,CAAG,iBAAjB,CAAoC,CAACwB,aAAa,CAACH,YAAf,CAApC,CACP,CACII,OAAO,CAAE,CACLC,aAAa,CAAE,UAAWL,YADrB,CADb,CADO,EAMNM,IANM,CAMD,SAAAC,GAAG,CAAI,CACT,GAAIA,GAAG,CAAChB,MAAJ,GAAe,GAAf,EAAsBgB,GAAG,CAAChB,MAAJ,GAAc,GAAxC,CAA6C,CACzCF,OAAO,CAACC,GAAR,CAAY,QAAZ,EACAE,YAAY,CAACgB,OAAb,CAAqB,WAArB,CAAiCD,GAAG,CAACE,IAAJ,CAASN,aAA1C,EACAX,YAAY,CAACgB,OAAb,CAAqB,MAArB,CAA4BD,GAAG,CAACE,IAAJ,CAASC,YAArC,EACAvB,eAAe,CAACiB,OAAhB,CAAwB,eAAxB,EAA2C,UAAYZ,YAAY,CAACS,OAAb,CAAqB,MAArB,CAAvD,CACA,MAAOvB,CAAAA,KAAK,CAACS,eAAD,CAAZ,CACH,CACJ,CAdM,EAeNwB,KAfM,CAeA,SAAAC,GAAG,CAAE,CACRvB,OAAO,CAACC,GAAR,CAAYsB,GAAG,CAAC5B,QAAhB,EACAQ,YAAY,CAACC,KAAb,GACAC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuB,QAAvB,CACH,CAnBM,CAAP,CAoBH,CAtBD,IAuBK,CACDP,OAAO,CAACC,GAAR,CAAY,wBAAZ,EACAE,YAAY,CAACC,KAAb,GACA,MAAOC,CAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuB,QAA9B,CAEH,CAEJ,CACJ,CAGD,MAAOC,CAAAA,OAAO,CAACC,MAAR,CAAeZ,KAAf,CAAP,CACF,CArDF,EAuDA,cAAeN,CAAAA,QAAf","sourcesContent":["import axios from 'axios';\r\nimport url from './BackendUrl';\r\n\r\nconst instance = axios.create(\r\n    {\r\n        baseURL: url\r\n    }\r\n\r\n);\r\n\r\ninstance.interceptors.response.use((response) => {\r\n    return response\r\n }, function (error) {\r\n\r\n    const originalRequest = error.config;\r\n    console.log(originalRequest);\r\n    \r\n    if(error){\r\n        if (error.response.status === 401 && originalRequest.url === url + \"auth/renewtoken\") {\r\n            localStorage.clear()\r\n            window.location.href = '/Login'\r\n            return Promise.reject(error);\r\n        }\r\n     \r\n        if (error.response.status === 401 && !originalRequest._retry) {\r\n     \r\n            originalRequest._retry = true;\r\n            const refreshToken = localStorage.getItem('ref_token');\r\n            if(refreshToken){\r\n                console.log(\"calling request\")\r\n                return axios.post(url + 'auth/renewtoken', {refresh_token:refreshToken},\r\n                {\r\n                    headers: {\r\n                        Authorization: 'Bearer '+ refreshToken\r\n                    }\r\n                })\r\n                .then(res => {\r\n                    if (res.status === 201 || res.status=== 200) {\r\n                        console.log(\"sucess\")\r\n                        localStorage.setItem(\"ref_token\",res.data.refresh_token);\r\n                        localStorage.setItem(\"user\",res.data.access_token);\r\n                        originalRequest.headers[\"Authorization\"] = 'Bearer ' + localStorage.getItem('user');\r\n                        return axios(originalRequest);\r\n                    }\r\n                })\r\n                .catch(err=>{\r\n                    console.log(err.response);\r\n                    localStorage.clear();\r\n                    window.location.href = '/Login'\r\n                })\r\n            }\r\n            else {\r\n                console.log(\"No ref token was found\")\r\n                localStorage.clear();\r\n                return window.location.href = '/Login'\r\n    \r\n            }\r\n            \r\n        }\r\n    }\r\n\r\n   \r\n    return Promise.reject(error);\r\n });\r\n\r\nexport default instance;"]},"metadata":{},"sourceType":"module"}